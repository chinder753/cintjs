import pyscf, pyscf.gto, pyscf.df
import numpy
import scipy.linalg

h2o = pyscf.gto.M(atom="H 0.0 0.5 0.0;H 0.0 -0.5 0.0;O 0.0 0.0 0.0", basis="sto-3g")
nocc = h2o.nelec[0]

S = h2o.intor("int1e_ovlp_cart")

S_val, S_vec = scipy.linalg.eigh(S)
S_val = S_val**-0.5
S_half_inv = numpy.einsum("ij, j, jk -> ik", S_vec, S_val, S_vec.transpose())

h_core = h2o.intor("int1e_kin_cart") + h2o.intor("int1e_nuc_cart")
int2e = h2o.intor("int2e_cart")
F_prime = S_half_inv @ h_core @ S_half_inv

e_mo, c_mo = scipy.linalg.eigh(F_prime)
c_mo = (S_half_inv @ c_mo)[:, :nocc]

P = c_mo @ c_mo.T


int2e = numpy.array([0.7746059443199184,0.3093104651892651,0.12720376490483296,0.5919701927706379,0,0.4460939706195738,0,0.3093104651892651,0.4780424296748907,0.1191149882427737,0.4594201430029964,0,-0.1596218751227519,0,0.12720376490483296,0.1191149882427737,0.8309493510464275,0.19309212147533916,0,0.021270034637820134,0,0.5919701927706379,0.4594201430029964,0.19309212147533916,0.6821279786372091,0,0.14875161046482746,0,0,0,0,0,0.6627348709707326,0,0,0.4460939706195738,-0.1596218751227519,0.021270034637820134,0.14875161046482746,0,0.7202372241568751,0,0,0,0,0,0,0,0.6627348709707326,0.309310465189265,0.157867121399942,0.06727893000682594,0.26852134544317446,0,0.14762804360516615,0,0.157867121399942,0.309310465189265,0.06727893000682594,0.26852134544317446,0,-0.14762804360516615,0,0.06727893000682594,0.06727893000682594,0.45956744829094587,0.10557518805148097,0,6.776263578034403e-20,0,0.26852134544317446,0.26852134544317446,0.10557518805148097,0.3547879642852825,0,-1.734723475976807e-18,0,0,0,0,0,0.3520603282176939,0,0,0.14762804360516615,-0.14762804360516615,6.776263578034403e-20,-1.734723475976807e-18,0,0.35997165181703245,0,0,0,0,0,0,0,0.3520603282176939,0.12720376490483298,0.06727893000682596,0.05778216327662823,0.11962941665286173,0,0.06517696769756007,0,0.06727893000682596,0.11911498824277368,0.05658563857699801,0.11521489073307839,0,-0.05428135295865399,0,0.05778216327662823,0.05658563857699801,0.4849129242612744,0.08841708244408046,0,0.0037642863078044394,0,0.11962941665286173,0.11521489073307839,0.08841708244408046,0.16343784545700196,0,0.0068556125810082195,0,0,0,0,0,0.16307486069691127,0,0,0.06517696769756007,-0.05428135295865399,0.0037642863078044394,0.0068556125810082195,0,0.16417526098931606,0,0,0,0,0,0,0,0.16307486069691127,0.5919701927706376,0.2685213454431745,0.11962941665286171,0.48987983737580043,0,0.31992424036727324,0,0.2685213454431745,0.45942014300299644,0.1152148907330784,0.42835505919012706,0,-0.18566654541883384,0,0.11962941665286171,0.1152148907330784,0.8006444822373898,0.184250806191682,0,0.011764829356729924,0,0.48987983737580043,0.42835505919012706,0.184250806191682,0.6088328289443041,0,0.07220477495472401,0,0,0,0,0,0.6026304577646484,0,0,0.31992424036727324,-0.18566654541883384,0.011764829356729924,0.07220477495472401,0,0.6207575511781774,0,0,0,0,0,0,0,0.6026304577646484,0,0,0,0,0.08668496413588787,0,0,0,0,0,0,0.07423272969033343,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.11936994856887528,0,0,0.08668496413588787,0.07423272969033343,0.02328222865508225,0.11936994856887528,0,0.016513616891037582,0,0,0,0,0,0.016513616891037582,0,0,0,0,0,0,0,0,0,0.4460939706195739,0.14762804360516613,0.0651769676975601,0.3199242403672731,0,0.2970764994134018,0,0.14762804360516613,0.1596218751227519,0.054281352958653974,0.18566654541883376,0,-0.0019208014230716346,0,0.0651769676975601,0.054281352958653974,0.3997751703695708,0.09347523681952669,0,0.029601714150877416,0,0.3199242403672731,0.18566654541883376,0.09347523681952669,0.32682120529685854,0,0.16052284008381693,0,0,0,0,0,0.016513616891037582,0,0,0.2970764994134018,-0.0019208014230716346,0.029601714150877416,0.16052284008381693,0,0.35685683611585584,0,0,0,0,0,0,0,0.016513616891037582,0,0,0,0,0,0,0.08668496413588787,0,0,0,0,0,0,0.07423272969033343,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.11936994856887528,0,0,0,0,0,0,0,0,0,0,0,0,0,0.31163217225965467,0.08668496413588787,0.07423272969033343,0.02328222865508225,0.11936994856887528,0,0.31163217225965467,0,0.309310465189265,0.157867121399942,0.06727893000682594,0.26852134544317446,0,0.14762804360516615,0,0.157867121399942,0.309310465189265,0.06727893000682594,0.26852134544317446,0,-0.14762804360516615,0,0.06727893000682594,0.06727893000682594,0.45956744829094587,0.10557518805148097,0,6.776263578034403e-20,0,0.26852134544317446,0.26852134544317446,0.10557518805148097,0.3547879642852825,0,-1.734723475976807e-18,0,0,0,0,0,0.3520603282176939,0,0,0.14762804360516615,-0.14762804360516615,6.776263578034403e-20,-1.734723475976807e-18,0,0.35997165181703245,0,0,0,0,0,0,0,0.3520603282176939,0.4780424296748907,0.309310465189265,0.1191149882427737,0.4594201430029964,0,0.1596218751227519,0,0.309310465189265,0.7746059443199184,0.12720376490483296,0.5919701927706379,0,-0.4460939706195738,0,0.1191149882427737,0.12720376490483296,0.8309493510464275,0.19309212147533916,0,-0.021270034637820134,0,0.4594201430029964,0.5919701927706379,0.19309212147533916,0.6821279786372091,0,-0.14875161046482746,0,0,0,0,0,0.6627348709707326,0,0,0.1596218751227519,-0.4460939706195738,-0.021270034637820134,-0.14875161046482746,0,0.7202372241568751,0,0,0,0,0,0,0,0.6627348709707326,0.11911498824277368,0.06727893000682596,0.05658563857699801,0.11521489073307839,0,0.05428135295865399,0,0.06727893000682596,0.12720376490483298,0.05778216327662823,0.11962941665286173,0,-0.06517696769756007,0,0.05658563857699801,0.05778216327662823,0.4849129242612744,0.08841708244408046,0,-0.0037642863078044394,0,0.11521489073307839,0.11962941665286173,0.08841708244408046,0.16343784545700196,0,-0.0068556125810082195,0,0,0,0,0,0.16307486069691127,0,0,0.05428135295865399,-0.06517696769756007,-0.0037642863078044394,-0.0068556125810082195,0,0.16417526098931606,0,0,0,0,0,0,0,0.16307486069691127,0.45942014300299644,0.2685213454431745,0.1152148907330784,0.42835505919012706,0,0.18566654541883384,0,0.2685213454431745,0.5919701927706376,0.11962941665286171,0.48987983737580043,0,-0.31992424036727324,0,0.1152148907330784,0.11962941665286171,0.8006444822373898,0.184250806191682,0,-0.011764829356729924,0,0.42835505919012706,0.48987983737580043,0.184250806191682,0.6088328289443041,0,-0.07220477495472401,0,0,0,0,0,0.6026304577646484,0,0,0.18566654541883384,-0.31992424036727324,-0.011764829356729924,-0.07220477495472401,0,0.6207575511781774,0,0,0,0,0,0,0,0.6026304577646484,0,0,0,0,0.07423272969033343,0,0,0,0,0,0,0.08668496413588787,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.11936994856887528,0,0,0.07423272969033343,0.08668496413588787,0.02328222865508225,0.11936994856887528,0,-0.016513616891037582,0,0,0,0,0,-0.016513616891037582,0,0,0,0,0,0,0,0,0,-0.1596218751227519,-0.14762804360516613,-0.054281352958653974,-0.18566654541883376,0,-0.0019208014230716346,0,-0.14762804360516613,-0.4460939706195739,-0.0651769676975601,-0.3199242403672731,0,0.2970764994134018,0,-0.054281352958653974,-0.0651769676975601,-0.3997751703695708,-0.09347523681952669,0,0.029601714150877416,0,-0.18566654541883376,-0.3199242403672731,-0.09347523681952669,-0.32682120529685854,0,0.16052284008381693,0,0,0,0,0,-0.016513616891037582,0,0,-0.0019208014230716346,0.2970764994134018,0.029601714150877416,0.16052284008381693,0,-0.35685683611585584,0,0,0,0,0,0,0,-0.016513616891037582,0,0,0,0,0,0,0.07423272969033343,0,0,0,0,0,0,0.08668496413588787,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.11936994856887528,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.31163217225965467,0.07423272969033343,0.08668496413588787,0.02328222865508225,0.11936994856887528,0,-0.31163217225965467,0,0.12720376490483298,0.06727893000682596,0.05778216327662823,0.11962941665286173,0,0.06517696769756007,0,0.06727893000682596,0.11911498824277368,0.05658563857699801,0.11521489073307839,0,-0.05428135295865399,0,0.05778216327662823,0.05658563857699801,0.4849129242612744,0.08841708244408046,0,0.0037642863078044394,0,0.11962941665286173,0.11521489073307839,0.08841708244408046,0.16343784545700196,0,0.0068556125810082195,0,0,0,0,0,0.16307486069691127,0,0,0.06517696769756007,-0.05428135295865399,0.0037642863078044394,0.0068556125810082195,0,0.16417526098931606,0,0,0,0,0,0,0,0.16307486069691127,0.11911498824277368,0.06727893000682596,0.05658563857699801,0.11521489073307839,0,0.05428135295865399,0,0.06727893000682596,0.12720376490483298,0.05778216327662823,0.11962941665286173,0,-0.06517696769756007,0,0.05658563857699801,0.05778216327662823,0.4849129242612744,0.08841708244408046,0,-0.0037642863078044394,0,0.11521489073307839,0.11962941665286173,0.08841708244408046,0.16343784545700196,0,-0.0068556125810082195,0,0,0,0,0,0.16307486069691127,0,0,0.05428135295865399,-0.06517696769756007,-0.0037642863078044394,-0.0068556125810082195,0,0.16417526098931606,0,0,0,0,0,0,0,0.16307486069691127,0.8309493510464278,0.4595674482909459,0.4849129242612743,0.8006444822373898,0,0.399775170369571,0,0.4595674482909459,0.8309493510464278,0.4849129242612743,0.8006444822373898,0,-0.399775170369571,0,0.4849129242612743,0.4849129242612743,4.785065752279987,0.7413803209249654,0,0,0,0.8006444822373898,0.8006444822373898,0.7413803209249654,1.1189468405635594,0,0,0,0,0,0,0,1.1158138186608244,0,0,0.399775170369571,-0.399775170369571,0,0,0,1.1158138186608244,0,0,0,0,0,0,0,1.1158138186608244,0.19309212147533905,0.10557518805148094,0.0884170824440804,0.184250806191682,0,0.09347523681952673,0,0.10557518805148094,0.19309212147533905,0.0884170824440804,0.184250806191682,0,-0.09347523681952673,0,0.0884170824440804,0.0884170824440804,0.7413803209249654,0.13687336736722408,0,0,0,0.184250806191682,0.184250806191682,0.13687336736722408,0.2566333713733561,0,0,0,0,0,0,0,0.25668396934142496,0,0,0.09347523681952673,-0.09347523681952673,0,0,0,0.25668396934142496,0,0,0,0,0,0,0,0.25668396934142496,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.024477410781866316,0,0,0,0,0,0,0.03780860585409406,0,0,0.02328222865508225,0.02328222865508225,0.024477410781866316,0.03780860585409406,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.021270034637820148,4.472333961502706e-19,0.00376428630780444,0.01176482935672993,0,0.029601714150877416,0,4.472333961502706e-19,-0.021270034637820148,-0.00376428630780444,-0.01176482935672993,0,0.029601714150877416,0,0.00376428630780444,-0.00376428630780444,0,0,0,0.024477410781866316,0,0.01176482935672993,-0.01176482935672993,0,0,0,0.03780860585409406,0,0,0,0,0,0,0,0,0.029601714150877416,0.029601714150877416,0.024477410781866316,0.03780860585409406,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.024477410781866316,0,0,0,0,0,0,0.03780860585409406,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.02328222865508225,0.02328222865508225,0.024477410781866316,0.03780860585409406,0,0,0,0.5919701927706376,0.2685213454431745,0.11962941665286171,0.48987983737580043,0,0.31992424036727324,0,0.2685213454431745,0.45942014300299644,0.1152148907330784,0.42835505919012706,0,-0.18566654541883384,0,0.11962941665286171,0.1152148907330784,0.8006444822373898,0.184250806191682,0,0.011764829356729924,0,0.48987983737580043,0.42835505919012706,0.184250806191682,0.6088328289443041,0,0.07220477495472401,0,0,0,0,0,0.6026304577646484,0,0,0.31992424036727324,-0.18566654541883384,0.011764829356729924,0.07220477495472401,0,0.6207575511781774,0,0,0,0,0,0,0,0.6026304577646484,0.45942014300299644,0.2685213454431745,0.1152148907330784,0.42835505919012706,0,0.18566654541883384,0,0.2685213454431745,0.5919701927706376,0.11962941665286171,0.48987983737580043,0,-0.31992424036727324,0,0.1152148907330784,0.11962941665286171,0.8006444822373898,0.184250806191682,0,-0.011764829356729924,0,0.42835505919012706,0.48987983737580043,0.184250806191682,0.6088328289443041,0,-0.07220477495472401,0,0,0,0,0,0.6026304577646484,0,0,0.18566654541883384,-0.31992424036727324,-0.011764829356729924,-0.07220477495472401,0,0.6207575511781774,0,0,0,0,0,0,0,0.6026304577646484,0.19309212147533905,0.10557518805148094,0.0884170824440804,0.184250806191682,0,0.09347523681952673,0,0.10557518805148094,0.19309212147533905,0.0884170824440804,0.184250806191682,0,-0.09347523681952673,0,0.0884170824440804,0.0884170824440804,0.7413803209249654,0.13687336736722408,0,0,0,0.184250806191682,0.184250806191682,0.13687336736722408,0.2566333713733561,0,0,0,0,0,0,0,0.25668396934142496,0,0,0.09347523681952673,-0.09347523681952673,0,0,0,0.25668396934142496,0,0,0,0,0,0,0,0.25668396934142496,0.6821279786372092,0.3547879642852824,0.16343784545700193,0.6088328289443039,0,0.3268212052968586,0,0.3547879642852824,0.6821279786372092,0.16343784545700193,0.6088328289443039,0,-0.3268212052968586,0,0.16343784545700193,0.16343784545700193,1.1189468405635596,0.2566333713733561,0,0,0,0.6088328289443039,0.6088328289443039,0.2566333713733561,0.8172062958888908,0,0,0,0,0,0,0,0.8170225911096052,0,0,0.3268212052968586,-0.3268212052968586,0,0,0,0.8170225911096052,0,0,0,0,0,0,0,0.8170225911096052,0,0,0,0,0.11936994856887527,0,0,0,0,0,0,0.11936994856887527,0,0,0,0,0,0,0.037808605854094054,0,0,0,0,0,0,0.1805183876338118,0,0,0.11936994856887527,0.11936994856887527,0.037808605854094054,0.1805183876338118,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.14875161046482743,-4.336808689942018e-19,0.00685561258100822,0.07220477495472402,0,0.16052284008381695,0,-4.336808689942018e-19,-0.14875161046482743,-0.00685561258100822,-0.07220477495472402,0,0.16052284008381695,0,0.00685561258100822,-0.00685561258100822,0,0,0,0.037808605854094054,0,0.07220477495472402,-0.07220477495472402,0,0,0,0.1805183876338118,0,0,0,0,0,0,0,0,0.16052284008381695,0.16052284008381695,0.037808605854094054,0.1805183876338118,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.11936994856887527,0,0,0,0,0,0,0.11936994856887527,0,0,0,0,0,0,0.037808605854094054,0,0,0,0,0,0,0.1805183876338118,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.11936994856887527,0.11936994856887527,0.037808605854094054,0.1805183876338118,0,0,0,0,0,0,0,0.08668496413588787,0,0,0,0,0,0,0.07423272969033343,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.11936994856887528,0,0,0.08668496413588787,0.07423272969033343,0.02328222865508225,0.11936994856887528,0,0.016513616891037582,0,0,0,0,0,0.016513616891037582,0,0,0,0,0,0,0,0,0,0,0,0,0,0.07423272969033343,0,0,0,0,0,0,0.08668496413588787,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.11936994856887528,0,0,0.07423272969033343,0.08668496413588787,0.02328222865508225,0.11936994856887528,0,-0.016513616891037582,0,0,0,0,0,-0.016513616891037582,0,0,0,0,0,0,0,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.024477410781866316,0,0,0,0,0,0,0.03780860585409406,0,0,0.02328222865508225,0.02328222865508225,0.024477410781866316,0.03780860585409406,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.11936994856887527,0,0,0,0,0,0,0.11936994856887527,0,0,0,0,0,0,0.037808605854094054,0,0,0,0,0,0,0.1805183876338118,0,0,0.11936994856887527,0.11936994856887527,0.037808605854094054,0.1805183876338118,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.6627348709707329,0.35206032821769423,0.16307486069691138,0.6026304577646484,0,0.016513616891037586,0,0.35206032821769423,0.6627348709707329,0.16307486069691138,0.6026304577646484,0,-0.016513616891037586,0,0.16307486069691138,0.16307486069691138,1.1158138186608246,0.2566839693414249,0,0,0,0.6026304577646484,0.6026304577646484,0.2566839693414249,0.8170225911096052,0,0,0,0,0,0,0,0.8801590896119943,0,0,0.016513616891037586,-0.016513616891037586,0,0,0,0.7852702008902424,0,0,0,0,0,0,0,0.7852702008902424,0,0,0,0,0.3116321722596548,0,0,0,0,0,0,-0.3116321722596548,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.3116321722596548,-0.3116321722596548,0,0,0,0.047444444360875915,0,0,0,0,0,0.047444444360875915,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.047444444360875915,0,0,0,0,0,0,0,0,0,0,0,0.047444444360875915,0,0,0.4460939706195739,0.14762804360516613,0.0651769676975601,0.3199242403672731,0,0.2970764994134018,0,0.14762804360516613,0.1596218751227519,0.054281352958653974,0.18566654541883376,0,-0.0019208014230716346,0,0.0651769676975601,0.054281352958653974,0.3997751703695708,0.09347523681952669,0,0.029601714150877416,0,0.3199242403672731,0.18566654541883376,0.09347523681952669,0.32682120529685854,0,0.16052284008381693,0,0,0,0,0,0.016513616891037582,0,0,0.2970764994134018,-0.0019208014230716346,0.029601714150877416,0.16052284008381693,0,0.35685683611585584,0,0,0,0,0,0,0,0.016513616891037582,-0.1596218751227519,-0.14762804360516613,-0.054281352958653974,-0.18566654541883376,0,-0.0019208014230716346,0,-0.14762804360516613,-0.4460939706195739,-0.0651769676975601,-0.3199242403672731,0,0.2970764994134018,0,-0.054281352958653974,-0.0651769676975601,-0.3997751703695708,-0.09347523681952669,0,0.029601714150877416,0,-0.18566654541883376,-0.3199242403672731,-0.09347523681952669,-0.32682120529685854,0,0.16052284008381693,0,0,0,0,0,-0.016513616891037582,0,0,-0.0019208014230716346,0.2970764994134018,0.029601714150877416,0.16052284008381693,0,-0.35685683611585584,0,0,0,0,0,0,0,-0.016513616891037582,0.021270034637820148,4.472333961502706e-19,0.00376428630780444,0.01176482935672993,0,0.029601714150877416,0,4.472333961502706e-19,-0.021270034637820148,-0.00376428630780444,-0.01176482935672993,0,0.029601714150877416,0,0.00376428630780444,-0.00376428630780444,0,0,0,0.024477410781866316,0,0.01176482935672993,-0.01176482935672993,0,0,0,0.03780860585409406,0,0,0,0,0,0,0,0,0.029601714150877416,0.029601714150877416,0.024477410781866316,0.03780860585409406,0,0,0,0,0,0,0,0,0,0,0.14875161046482743,-4.336808689942018e-19,0.00685561258100822,0.07220477495472402,0,0.16052284008381695,0,-4.336808689942018e-19,-0.14875161046482743,-0.00685561258100822,-0.07220477495472402,0,0.16052284008381695,0,0.00685561258100822,-0.00685561258100822,0,0,0,0.037808605854094054,0,0.07220477495472402,-0.07220477495472402,0,0,0,0.1805183876338118,0,0,0,0,0,0,0,0,0.16052284008381695,0.16052284008381695,0.037808605854094054,0.1805183876338118,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.3116321722596548,0,0,0,0,0,0,-0.3116321722596548,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.3116321722596548,-0.3116321722596548,0,0,0,0.047444444360875915,0,0,0,0,0,0.047444444360875915,0,0,0,0,0,0,0,0,0,0.7202372241568753,0.35997165181703233,0.1641752609893161,0.6207575511781775,0,0.35685683611585595,0,0.35997165181703233,0.7202372241568753,0.1641752609893161,0.6207575511781775,0,-0.35685683611585595,0,0.1641752609893161,0.1641752609893161,1.1158138186608246,0.2566839693414249,0,0,0,0.6207575511781775,0.6207575511781775,0.2566839693414249,0.8170225911096052,0,0,0,0,0,0,0,0.7852702008902424,0,0,0.35685683611585595,-0.35685683611585595,0,0,0,0.8801590896119943,0,0,0,0,0,0,0,0.7852702008902424,0,0,0,0,0,0,0.016513616891037586,0,0,0,0,0,0,-0.016513616891037586,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.047444444360875915,0.016513616891037586,-0.016513616891037586,0,0,0,0.047444444360875915,0,0,0,0,0,0,0,0.08668496413588787,0,0,0,0,0,0,0.07423272969033343,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.11936994856887528,0,0,0,0,0,0,0,0,0,0,0,0,0,0.31163217225965467,0.08668496413588787,0.07423272969033343,0.02328222865508225,0.11936994856887528,0,0.31163217225965467,0,0,0,0,0,0,0,0.07423272969033343,0,0,0,0,0,0,0.08668496413588787,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.11936994856887528,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.31163217225965467,0.07423272969033343,0.08668496413588787,0.02328222865508225,0.11936994856887528,0,-0.31163217225965467,0,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.02328222865508225,0,0,0,0,0,0,0.024477410781866316,0,0,0,0,0,0,0.03780860585409406,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.02328222865508225,0.02328222865508225,0.024477410781866316,0.03780860585409406,0,0,0,0,0,0,0,0,0,0.11936994856887527,0,0,0,0,0,0,0.11936994856887527,0,0,0,0,0,0,0.037808605854094054,0,0,0,0,0,0,0.1805183876338118,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.11936994856887527,0.11936994856887527,0.037808605854094054,0.1805183876338118,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.047444444360875915,0,0,0,0,0,0,0,0,0,0,0,0.047444444360875915,0,0,0,0,0,0,0,0,0.016513616891037586,0,0,0,0,0,0,-0.016513616891037586,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.047444444360875915,0.016513616891037586,-0.016513616891037586,0,0,0,0.047444444360875915,0,0.6627348709707329,0.35206032821769423,0.16307486069691138,0.6026304577646484,0,0.016513616891037586,0,0.35206032821769423,0.6627348709707329,0.16307486069691138,0.6026304577646484,0,-0.016513616891037586,0,0.16307486069691138,0.16307486069691138,1.1158138186608246,0.2566839693414249,0,0,0,0.6026304577646484,0.6026304577646484,0.2566839693414249,0.8170225911096052,0,0,0,0,0,0,0,0.7852702008902424,0,0,0.016513616891037586,-0.016513616891037586,0,0,0,0.7852702008902424,0,0,0,0,0,0,0,0.8801590896119944])
int2e = int2e.reshape(7, 7, 7, 7)

J = numpy.einsum("ijkl, kl", int2e, P)
K = numpy.einsum("ikjl, kl", int2e, P)
# print(J)
G = 2 * J - K

# print(int2e[(int2e_prime-int2e)>1e-5])
# print(int2e_prime[(int2e_prime-int2e)>1e-5])

F = h_core + G
F_prime = S_half_inv @ F @ S_half_inv
e_mo, c_mo = scipy.linalg.eigh(F_prime)
print(e_mo)

# hf = pyscf.scf.HF(h2o).run()
# print(hf.mo_energy)


